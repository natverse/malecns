<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Access to the latest Janelia FlyEM datasets • malecns</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Access to the latest Janelia FlyEM datasets">
<meta name="description" content="Provides access to the latest Janelia FlyEM datasets by providing a thin wrapper around the malevnc package.">
<meta property="og:description" content="Provides access to the latest Janelia FlyEM datasets by providing a thin wrapper around the malevnc package.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">malecns</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/flyconnectome/malecns/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="malecns">malecns<a class="anchor" aria-label="anchor" href="#malecns"></a>
</h1></div>
<!-- badges: start -->

<p>The goal of <strong>malecns</strong> is to provide <a href="https://natverse.org" class="external-link">natverse</a> access to the whole male central nervous system dataset from Janelia FlyEM.</p>
<div class="section level2">
<h2 id="quick-start">Quick start<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"natmanager"</span><span class="op">)</span></span>
<span><span class="fu">natmanager</span><span class="fu">::</span><span class="fu">check_pat</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">natmanager</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span>pkgs<span class="op">=</span><span class="st">"flyconnectome/malecns"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/edit.html" class="external-link">edit_r_profile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># paste in this text, appropriately edited, and close the file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>malevnc.clio_email<span class="op">=</span><span class="st">"myuser@gmail.com"</span><span class="op">)</span></span>
<span><span class="co"># e.g. "jefferisg"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>malevnc.dvid_user<span class="op">=</span><span class="st">"&lt;surname&gt;&lt;firstinitial&gt;"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Set your Neuprint token</span></span>
<span><span class="co"># will open your browser</span></span>
<span><span class="co"># collect token by clicking on your account icon top right and then Account</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/browseURL.html" class="external-link">browseURL</a></span><span class="op">(</span><span class="st">'https://neuprint-cns.janelia.org'</span><span class="op">)</span></span>
<span><span class="co"># back in R</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/edit.html" class="external-link">edit_r_environ</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># paste in this text replacing with your neuprint token</span></span>
<span><span class="co"># make sure you have a new lined at the end of the file</span></span>
<span><span class="va">neuprint_token</span><span class="op">=</span><span class="st">"eyJhbGci..."</span></span>
<span></span>
<span><span class="co"># check everything's configured ok</span></span>
<span><span class="fu"><a href="reference/dr_malecns.html">dr_malecns</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get some data</span></span>
<span><span class="va">pnmeta</span><span class="op">=</span><span class="fu"><a href="reference/mcns_neuprint_meta.html">mcns_neuprint_meta</a></span><span class="op">(</span><span class="st">'/.+_[adl]+PN'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">pnmeta</span><span class="op">$</span><span class="va">type</span><span class="op">)</span></span>
<span><span class="va">vm6</span><span class="op">=</span><span class="fu"><a href="reference/read_mcns_meshes.html">read_mcns_meshes</a></span><span class="op">(</span><span class="st">'VM6_adPN'</span><span class="op">)</span></span>
<span><span class="fu">plot3d</span><span class="op">(</span><span class="va">malecns.surf</span>, alpha<span class="op">=</span><span class="fl">.1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><strong>malecns</strong> is presently a very thin wrapper around the <a href="https://github.com/flyconnectome/malevnc" class="external-link">malevnc</a> package. In due course we would hope to separate out some of the more generic functionality from the <strong>malevnc</strong> package. However, the current arrangement means that some of the configuration for using the <strong>malecns</strong> package is handled by the <strong>malevnc</strong> package.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>This package points to private resources made available by the male CNS project led by the FlyEM team at Janelia. You will therefore need appropriate authorisation both to install the package from github and access the data.</p>
<p>You can install the released version of malecns from GitHub</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"natmanager"</span><span class="op">)</span></span>
<span><span class="fu">natmanager</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span>pkgs<span class="op">=</span><span class="st">"flyconnectome/malecns"</span><span class="op">)</span></span></code></pre></div>
<p>Note that you must have been given access to the <a href="https://github.com/flyconnectome/malecns/" class="external-link">github repository</a> and have a GitHub Personal Access Token (PAT) set up in order to install the library for as long as it remains private. Do :</p>
<pre><code><span><span class="fu">natmanager</span><span class="fu">::</span><span class="fu">check_pat</span><span class="op">(</span><span class="op">)</span></span></code></pre>
<p>to check and follow the instructions if necessary to create. Should you run into any errors with that (there have been some significant changes at github recently), you can also try:</p>
<pre><code><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/github-token.html" class="external-link">create_github_token</a></span><span class="op">(</span><span class="op">)</span></span></code></pre>
<div class="section level3">
<h3 id="authentication">Authentication<a class="anchor" aria-label="anchor" href="#authentication"></a>
</h3>
<p>Access to neuprint / Clio then depends on authentication. For neuprint, please see <a href="https://github.com/natverse/neuprintr#authentication" class="external-link uri">https://github.com/natverse/neuprintr#authentication</a>; you only need to set a <code>NEUPRINT_TOKEN</code> R environment variable. You can display your neuprint token after logging into the neuprint website. For Clio, you will prompted to authenticate via a Google OAuth “dance” in your web browser. Note that the Clio and neuprint tokens look similar, but are <em>not</em> the same. Your neuprint token appears to be indefinite while the clio token currently lasts 3 weeks.</p>
</div>
<div class="section level3">
<h3 id="configuration">Configuration<a class="anchor" aria-label="anchor" href="#configuration"></a>
</h3>
<p>For interaction with the Clio/DVID annotation systems you may need to tell R+malecns about the emails that you used to sign up for Clio/neuprint.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>malevnc.clio_email<span class="op">=</span><span class="st">"myuser@gmail.com"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>malevnc.dvid_user<span class="op">=</span><span class="st">"&lt;surname&gt;&lt;firstinitial&gt;"</span><span class="op">)</span></span></code></pre></div>
<p>These should be set in your <code>.Rprofile</code> file.</p>
</div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>This example shows you how to read some meshes, look up ids by position and transform positions from FlyWire/FAFB14.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/flyconnectome/malecns" class="external-link">malecns</a></span><span class="op">)</span></span>
<span><span class="co">## read meshes for some annotated neurons</span></span>
<span></span>
<span><span class="va">gs</span><span class="op">=</span><span class="st">"https://docs.google.com/spreadsheets/d/13e2yboGmSHrkdew0REkqXWrx5PfHrwPbZZArySjIHtA/edit?usp=sharing"</span></span>
<span><span class="va">mca</span><span class="op">=</span><span class="fu">googlesheets4</span><span class="fu">::</span><span class="fu">read_sheet</span><span class="op">(</span><span class="va">gs</span><span class="op">)</span></span>
<span><span class="co"># update bodyids based on XYZ position</span></span>
<span><span class="va">mca</span><span class="op">$</span><span class="va">position</span><span class="op">=</span><span class="fu"><a href="reference/mcns_xyz2bodyid.html">mcns_xyz2bodyid</a></span><span class="op">(</span><span class="va">mca</span><span class="op">$</span><span class="va">position</span><span class="op">)</span></span>
<span></span>
<span><span class="va">confirmed_neurondf</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">mca</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">ontology</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ml</span><span class="op">=</span><span class="fu"><a href="reference/read_mcns_meshes.html">read_mcns_meshes</a></span><span class="op">(</span><span class="va">confirmed_neurondf</span><span class="op">)</span></span>
<span><span class="fu">plot3d</span><span class="op">(</span><span class="va">ml</span>, col<span class="op">=</span><span class="va">symbol</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">natverse</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/natverse/fafbseg" class="external-link">fafbseg</a></span><span class="op">)</span></span>
<span><span class="co"># transform a point in FlyWire voxel space to malecns voxel space</span></span>
<span><span class="co"># and put it on the clipbaord ready to paste into neuroglancer</span></span>
<span><span class="fu">clipr</span><span class="fu">::</span><span class="fu"><a href="http://matthewlincoln.net/clipr/reference/write_clip.html" class="external-link">write_clip</a></span><span class="op">(</span><span class="fu">xform_brain</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">109953</span>, <span class="fl">50450</span>, <span class="fl">1660</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">40</span><span class="op">)</span>, </span>
<span>  reference <span class="op">=</span> <span class="st">'malecns'</span>,   sample <span class="op">=</span> <span class="st">'FlyWire'</span><span class="op">)</span><span class="op">/</span><span class="fl">8</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="updating">Updating<a class="anchor" aria-label="anchor" href="#updating"></a>
</h2>
<p>If you need to update your malecns install, I recommend:</p>
<pre><code><span><span class="fu">natmanager</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span>pkgs<span class="op">=</span><span class="st">"flyconnectome/malecns"</span><span class="op">)</span></span></code></pre>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/flyconnectome/malecns/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/flyconnectome/malecns/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing malecns</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Gregory Jefferis <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-0587-9355" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
<li><a href="https://github.com/flyconnectome/malecns/actions" class="external-link"><img src="https://github.com/flyconnectome/malecns/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gregory Jefferis.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
